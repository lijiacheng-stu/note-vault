##### 1.功能：
- 提供进程和进程之间的逻辑通信
- 复用和分用
- 传输层对收到的报文进行差错检测（网络层就不需要差错检测，只需要检测头部）
- 可选（TCP流量控制，拥塞控制，可靠传输 UDP没有）

##### 2.UDP协议
2.1特点：
ip的特点+：
- 无连接
- 最大努力交付
- 无拥塞控制，适合实应时应用
新增的特点：
- 面向报文的
- UDP首部 8B （TCP20B）

2.2UDP首部
![[Pasted image 20250310210916.png]]

2.3UDP校验过程：
添加了伪首部，如框所示，伪首部只有在计算校验和时才出现。
![[Pasted image 20250310211354.png]]
![[Pasted image 20250310211732.png]]
注：在发送端考虑的是校验和填什么。接收端考虑的是，数据数据对不对。都有添加伪首部的过程。

##### 3.TCP
3.1特点：
- 面向连接（虚连接）=>一条TCP连接只有两个端点
- 提供全双工通信=>发送缓存，接受缓存
- 提供可靠交付的服务 
- TCP面向字节流

3.2TCP首部
![[Pasted image 20250310213204.png]]
序号：字节流中的字节按顺序编号。这个序号表示该TCP报文所发送的第一个字节的编号。
确认号：希望收到的序号
数据偏移：首部长度，单位4B, 占用4bit
窗口：现在允许对方发送的数据量
![[Pasted image 20250310214332.png]]
![[Pasted image 20250310214626.png]]
3.3TCP的连接管理
连接建立
![[Pasted image 20250310215102.png]]
连接释放
![[Pasted image 20250310215618.png]]
3.4TCP可靠传输
- 校验
协议字段改成6，其他过程与udp一样
![[Pasted image 20250310221240.png]]
- 确认
累计确认，捎带确认。
为字节流中的每个字节进行编号，称为序号。采用累计确认的方法。假设确认号为ack = 100表示序号为99以前的都正确接收，期待接收序号为100的TCP报文段。效果是发送发的发送缓存可以释放99以前的数据占用的空间。
接收方可能数据发送，ack的信息就在这个时候发送过去。
- 重传
超时重传，快重传。
TCP的发送方在规定时间（重传时间）内没有收到某一帧的确认，重传该帧。
收到三个冗余ACK（也就是收到表达了对某个序号开头的报文段期望的ACK第四次）后，发送方不等到重传时间到，立马重传期望的报文段。
冗余ACK产生的条件是接收方每当收到比期望序号大的失序报文段时发送。

校验保证了每个TCP报文的正确性。确认保证了报文段在小于某个范围的正确性。重传保证了有TCP报文丢失的情况下， 发送端进行弥补，能够准确补充，保证报文段的正确的范围不断扩大。

3.5TCP流量控制
目的：保证发送方发送的数据接收方能够来得及接收到。换句话说，接收缓存已经满了还没来得及读的情况下，发送方别发了。
手段：窗口字段，接收方根据自己接收缓存的大小，动态地调整发送窗口的大小rwnd。

3.6 拥塞控制
**目的：** 防止继续向网络中注入大量数据，使得已拥塞的网络性能更坏。全局性。
**手段:** 
通用：
- 发送窗口=min{rwnd,cwnd}
- 网络拥塞后慢开始阈值ssthresh进行更新，更新为发生拥塞时候拥塞窗口cwnd的一半。


慢开始，拥塞避免：
- 慢开始：中的慢是指刚开始的时候，cwnd设置为很小的值1，而不是很大。不是说它指数增长速率。
- 拥塞避免：是指达到ssthresh后”加法增大“而不是仍然指数增长。
![[Pasted image 20250310225120.png]]

快重传，快恢复：
- 快重传：这里的快是指收到三个冗余ack后立马重传接收方渴望的tcp报文，而不是等到该报文的重传时间到了再发送。
- 快恢复：不像tahoe版本从1开始，而是从新的ssthresh开始。
![[Pasted image 20250310230320.png]]

